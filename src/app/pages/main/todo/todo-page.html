<div class="layout">
  <div class="todo-list">
    <div class="todo-input-wrapper">
      <input class="todo-input" type="text" placeholder="할 일 추가" [(ngModel)]="newText" />
      <button class="add-btn" type="button" (click)="add()" [disabled]="isAdding">+</button>
    </div>

    <div class="toolbar">
      <input
        class="search-input"
        type="text"
        placeholder="찾을 내용을 입력해 주세요."
        [(ngModel)]="searchText"
        (ngModelChange)="!searchText.trim() && todoStore.setSearch('')"
        (keydown.enter)="todoStore.setSearch(searchText)"
      />

      <select
        class="sort-select"
        [ngModel]="todoStore.query().priorityFilter ?? ''"
        (ngModelChange)="todoStore.setPriorityFilter($event || undefined)"
      >
        <option value="">우선순위(전체)</option>
        <option value="urgent">긴급</option>
        <option value="normal">보통</option>
        <option value="low">낮음</option>
      </select>

      <button class="sort-btn" type="button" (click)="todoStore.toggleSortMode()">
        {{ todoStore.getSortLabel() }}
      </button>
    </div>

    <div class="todo-content">
      <app-todo-create-panel
        (todoClick)="onClickTodo($event)"
        (toggle)="todoStore.toggleTodo($event)"
      ></app-todo-create-panel>
    </div>
  </div>
  <!-- 수정모드 -->
  <div class="todo-details-wrapper">
    <div class="todo-title-wrapper" *ngIf="todoStore.selectedTodo() as todo">
      <ng-container *ngIf="!isEditMode; else editHeader">
        <div class="todo-title">{{ todo.title }}</div>

        <div class="todo-edit-btn">
          <button class="update-btn" type="button" (click)="startEdit()">수정하기</button>
          <button class="delete-btn" type="button" (click)="deleteSelected()">삭제하기</button>
        </div>
      </ng-container>

      <ng-template #editHeader>
        <input class="todo-title" type="text" [(ngModel)]="editTitle" />

        <div class="todo-edit-btn">
          <button class="update-btn" type="button" (click)="saveEdit()">저장하기</button>
          <button class="delete-btn" type="button" (click)="cancelEdit()">취소</button>
        </div>
      </ng-template>
    </div>

    <div class="todo-details">
      <app-todo-detail-panel *ngIf="!isEditMode"></app-todo-detail-panel>
      <div class="todo-detail" *ngIf="isEditMode && todoStore.selectedTodo() as todo">
        <div class="todo-meta">
          <ul>
            <li>
              <span class="label">생성일자</span>
              <span class="value">{{ todo.createdAt | date : 'yyyy-MM-dd' }}</span>
            </li>
            <li>
              <span class="label">수정일자</span>
              <span class="value">{{
                todo.updatedAt ? (todo.updatedAt | date : 'yyyy-MM-dd') : '-'
              }}</span>
            </li>
            <li>
              <span class="label">완료일자</span>
              <span class="value">{{
                todo.completedAt ? (todo.completedAt | date : 'yyyy-MM-dd') : '-'
              }}</span>
            </li>
            <li>
              <span class="label">우선순위</span>
              <select [(ngModel)]="editPriority">
                <option value="urgent">긴급</option>
                <option value="normal">보통</option>
                <option value="low">낮음</option>
              </select>
            </li>
          </ul>
        </div>

        <div class="todo-content">
          <textarea [(ngModel)]="editContent"></textarea>
        </div>
      </div>
    </div>
  </div>
</div>
